// Generated by CoffeeScript 1.6.3
(function() {
  var MainView, ModuleView, MojoModules, bindableCall, mojo, _ref, _ref1,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  mojo = require("mojojs");

  bindableCall = require("bindable-call");

  MojoModules = require("../../models/mojoModules");

  ModuleView = (function(_super) {
    __extends(ModuleView, _super);

    function ModuleView() {
      _ref = ModuleView.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    ModuleView.prototype.paper = require("./module.pc");

    return ModuleView;

  })(mojo.View);

  MainView = (function(_super) {
    __extends(MainView, _super);

    function MainView() {
      this._debounceSearch = __bind(this._debounceSearch, this);
      _ref1 = MainView.__super__.constructor.apply(this, arguments);
      return _ref1;
    }

    /*
    */


    MainView.prototype.define = ["findNpmModulesRequest", "loading", "modules"];

    /*
    */


    MainView.prototype.bindings = {
      "findNpmModulesRequest.loading": "loading",
      "models.scrollBottom": function(v) {
        if (!v) {
          return;
        }
        return this.loadMore();
      }
    };

    /*
    */


    MainView.prototype.paper = require("./index.pc");

    /*
    */


    MainView.prototype._onRender = function() {
      MainView.__super__._onRender.call(this);
      return this.set("modules", new MojoModules());
    };

    /*
    */


    MainView.prototype.search = function(keyword) {
      this.set("keyword", keyword);
      clearTimeout(this._searchTimeout);
      return this._searchTimeout = setTimeout(this._debounceSearch, 200);
    };

    /*
    */


    MainView.prototype._debounceSearch = function(keyword) {
      var _this = this;
      return this.set("findNpmModulesRequest", bindableCall(function(next) {
        return _this.modules.search(_this.get("keyword"), next);
      }));
    };

    /*
    */


    MainView.prototype.loadMore = function() {
      var _this = this;
      return this.set("findNpmModulesRequest", bindableCall(function(next) {
        return _this.modules.loadMore(next);
      }));
    };

    /*
    */


    MainView.prototype.sections = {
      modules: {
        type: "list",
        source: "modules",
        modelViewClass: ModuleView,
        sort: function(a, b) {
          if (a.get("model.watchers") > b.get("model.watchers")) {
            return -1;
          } else {
            return 1;
          }
        }
      }
    };

    return MainView;

  })(mojo.View);

  module.exports = MainView;

}).call(this);
